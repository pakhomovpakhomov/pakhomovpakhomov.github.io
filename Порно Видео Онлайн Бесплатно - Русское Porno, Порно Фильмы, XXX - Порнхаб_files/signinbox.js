var Signinbox={recaptchaCompleted:!1,showCaptcha:!1,container:null,config:null,init:function(){if(this.container&&this.config){let e=this.container.querySelector(".js-signinUsername"),t=this.container.querySelector(".js-signinPassword"),i=this.container.querySelector(".js-loginSubmit"),s=this.container.querySelector(".passIcon");e.focus(),s&&s.addEventListener("click",function(){s.classList.contains("ph-icon-view-on")?(s.classList.remove("ph-icon-view-on"),s.classList.add("ph-icon-view-off"),t.type="password"):(s.classList.add("ph-icon-view-on"),s.classList.remove("ph-icon-view-off"),t.type="text")}),i.addEventListener("click",this.loginClickFunction.bind(this)),e.addEventListener("keydown",this.keyDownFunction.bind(this)),t.addEventListener("keydown",this.keyDownFunction.bind(this)),MG_Utils.hasClass(i,"disabled")||(i.setAttribute("disabled","disabled"),MG_Utils.addClass(i,"disabled")),e.addEventListener("input",this.inputFunction.bind(this)),t.addEventListener("input",this.inputFunction.bind(this)),e&&0<e.value.length&&e.dispatchEvent(new Event("input")),t&&0<t.value.length&&t.dispatchEvent(new Event("input"))}else console.error("container & config can't be null")},captchaAcknowledgement:function(e){if(e)switch(e){case"verified":this.recaptchaCompleted=!0,this.toggleButtonDisable(!1);break;case"expired":case"error":this.toggleButtonDisable(!0);break;default:return}},toggleButtonDisable:function(e){var t=this.container.querySelector(".js-loginSubmit");e?MG_Utils.addClass(t,"disabled"):MG_Utils.removeClass(t,"disabled")},toggleElementDisable:function(e,t,i){e=document.getElementById(e);i?e&&!MG_Utils.hasClass(e,"disabled")&&MG_Utils.addClass(e,"disabled"):e&&MG_Utils.hasClass(e,"disabled")&&MG_Utils.removeClass(e,"disabled")},loginAjax:function(i="",s=""){var a=(e,t)=>{this.toggleButtonDisable(!0);let i={};""!==t?(i=Object.fromEntries(new FormData(jQuery(t)[0])),0<e.length&&(i.sso_token=e)):i=jQuery(".js-loginForm").serialize(),jQuery.ajax({type:"POST",url:this.config.loginUrl,cache:!1,dataType:"json",data:i,success:this.loginAjaxSuccess.bind(this),error:this.loginFailed.bind(this)})};try{let e=this.container.querySelector(".g-recaptcha"),t=!e||!e.firstChild;null!=typeof CaptachaComponents&&function(){if(t)return!0;{let e=!1;return e=document.querySelectorAll(".g-recaptcha").length?0<CaptachaComponents.getCaptchaResponse(this.getCaptchaInstanceIndex()).length:e}}()&&a(i,s)}catch(e){a(i,s)}},setupTwoStepVerification:function(d){let e=".default2fa";switch(d.twoStepVerificationType){case"google2fa":e=".google2fa";break;case"email":e=".email2fa"}var u=document.querySelectorAll(e),h=document.querySelector(".js-userVerificationModal");if(h){MG_Utils.hasClass(h.parentElement,"modal-body")&&MG_Utils.addClass(h.parentElement,"userVerificationModal");for(let e=0;e<u.length;e++)MG_Utils.hasClass(u[e],"displayNone")&&MG_Utils.removeClass(u[e],"displayNone");MG_Utils.removeClass(h,"displayNone");let e=h.querySelector("#userPhoneNumber"),t=h.querySelector("#userEmail"),i=h.querySelector("#enterVerificationCode"),s=h.querySelector("#btnVerifyCode"),a=h.querySelector("#verificationEnabledUsername"),n=h.querySelector("#verificationEnabledEmail"),l=h.querySelector("#verificationEnabledToken"),o=h.querySelector("#resendVerificationCode"),r=h.querySelector("#authyIdHashed"),c=h.querySelector("#authyId");o&&(h.dataset.type=d.twoStepVerificationType||"existingLegacy",e&&(e.innerHTML=d.phoneNumber),t&&(t.innerHTML=d.email),a&&l&&(a.value=d.username,l.value=d.autoLoginParameter),n&&l&&(n.value=d.email,l.value=d.autoLoginParameter),c&&r&&(c.value=d.authyId,r.value=d.authyIdHashed),i&&s&&(MG_Utils.addEventHandler(i,"input",function(e){""!==i.value?MG_Utils.hasClass(s,"disabled")&&(MG_Utils.removeClass(s,"disabled"),MG_Utils.removeClass(o,"disabled")):MG_Utils.hasClass(s,"disabled")||(MG_Utils.addClass(s,"disabled"),MG_Utils.addClass(o,"disabled"))}),s.addEventListener("click",e=>{e.preventDefault(),MG_Utils.hasClass(s,"disabled")||(MG_Utils.addClass(s,"disabled"),MG_Utils.addClass(o,"disabled"),this.loginTwoStepVerificationSend())}),i.addEventListener("keydown",e=>{var t=e.which||e.keyCode;13===t&&(e.preventDefault(),MG_Utils.hasClass(s,"disabled")||(MG_Utils.addClass(s,"disabled"),MG_Utils.addClass(o,"disabled"),this.loginTwoStepVerificationSend())),69===t&&e.preventDefault()})),o.addEventListener("click",this._twoStepVerificationResend.bind(this)))}},_twoStepVerificationResend:function(e){e.preventDefault();let t=document.querySelector("#authyIdHashed"),i=document.querySelector("#authyId"),s=document.getElementById("enterVerificationCode"),a=document.querySelector(".twoStepVerificationMessage.verificationError"),n=i.value,l=t.value,o=document.querySelector("#modalWrapMTubes .resendCodeResponse");this.toggleElementDisable("resendVerificationCode","disabled",!0),this.toggleElementDisable("btnVerifyCode","disabled",!0),s&&""!==s.value&&(s.value=""),a&&""!==a.innerHTML&&(a.innerHTML=""),jQuery.ajax({type:"POST",url:this.config.urlResendCode,dataType:"json",data:{authyId:n,authyIdHashed:l,token:this.config.token},success:e=>{o&&(MG_Utils.removeClass(o,"displayNone"),this.toggleElementDisable("resendVerificationCode","disabled",!1),"success"!=e.status?(MG_Utils.addClass(o,"verificationError"),jQuery(o).find(".resendCodeMessage").text(e.message)):(MG_Utils.hasClass(o,"verificationError")&&MG_Utils.removeClass(o,"verificationError"),MG_Utils.addClass(o,"verificationSuccess"),jQuery(o).find(".resendCodeMessage").text(e.message),setTimeout(function(){MG_Utils.addClass(o,"displayNone")},3e3)))},error:this.loginFailed.bind(this)})},loginTwoStepVerificationSend:function(){jQuery.ajax({type:"POST",url:this.config.loginUrl,data:jQuery("#modalWrapMTubes .js-userVerificationModal").serialize(),success:e=>{var t=document.querySelector("#modalWrapMTubes .twoStepVerificationMessage");t&&MG_Utils.removeClass(t,"displayNone"),this.toggleElementDisable("resendVerificationCode","disabled",!1),"0"!=e.success?(t&&MG_Utils.hasClass(t,"verificationError")&&MG_Utils.removeClass(t,"verificationError"),MG_Utils.addClass(t,"verificationSuccess"),t.innerHTML='<span class="greenLoader"></span>'+this.config.verificationSuccessfulMessage,this.callbackSuccess(e)):""!=e.message&&t?(MG_Utils.addClass(t,"verificationError"),t.innerHTML=e.message):""==e.message&&(alert(this.config.ajaxError),document.location.reload())},error:()=>{alert(this.config.ajaxError),document.location.reload()}})},getCaptchaInstanceIndex:function(){let i=this.container.querySelector(".g-recaptcha"),s=0;return document.querySelectorAll(".g-recaptcha").length&&[].forEach.call(document.querySelectorAll(".g-recaptcha"),function(e,t){e===i&&(s=t)}),s},setupCaptacha:function(){var e=this.container.querySelector(".g-recaptcha");e&&null!=typeof CaptachaComponents&&(this.recaptchaCompleted?CaptachaComponents.resetCaptcha(this.getCaptchaInstanceIndex()):CaptachaComponents.registerComponent(e,this.captchaAcknowledgement.bind(this)))},premiumModalFromResponse:function(e){this.signInUtilModal&&this.signInUtilModal.closeModal(),this.toggleButtonDisable(!1)},callbackSuccess:function(e){},loginAjaxSuccess:function(e){},loginFailed:function(){this.toggleButtonDisable(!1),document.location.reload()},loginClickFunction:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var e=this.container.querySelector(".js-loginSubmit"),t=this.container.querySelector(".js-signinUsername"),i=this.container.querySelector(".js-signinPassword");MG_Utils.hasClass(e,"disabled")||t&&0<t.value.length&&i&&0<i.value.length&&this.loginAjax()},inputFunction:function(e){var t=this.container.querySelector(".js-loginSubmit"),i=this.container.querySelector(".js-signinUsername"),s=this.container.querySelector(".js-signinPassword");i&&0<i.value.length&&s&&0<s.value.length?(t&&t.removeAttribute("disabled"),MG_Utils.removeClass(t,"disabled")):(t&&t.setAttribute("disabled","disabled"),MG_Utils.addClass(t,"disabled"))},keyDownFunction:function(e){13==(e.which||e.keyCode)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e=this.container.querySelector(".js-loginSubmit"),MG_Utils.hasClass(e,"disabled")||this.loginAjax())}};